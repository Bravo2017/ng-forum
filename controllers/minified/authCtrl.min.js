!function(e){function r(e,r,a,o,i,t,s,l,n){function u(e){for(var r=["abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!?_-"],a="",o=0;e>o;o+=1)a+=r[Math.floor(Math.random()*r.length)];return a}e.loadImageJSON="NOTLOADED",i.checkAuth(a.ref(),"authHome.desc"),e.forgotPass=function(){alertify.prompt("Recover Password","Enter Email Of Account",function(e,r){a.ref().resetPassword({email:r},function(e){if(e)switch(e.code){case"INVALID_USER":alertify.error("The specified user account does not exist.");break;default:alertify.error("Error resetting password:"+e)}else alertify.success("Password reset email sent successfully!")})})},e.oAuth=function(r){a.ref().authWithOAuthPopup(r,function(i,s){if(i)alertify.error("Register Error");else{console.log(s);var l=(o(a.ref().child("UserAuthInfo").child(s.uid)),t(a.ref().child("UserAuthInfo")));e.isDupe=!1,e.isUsernameDupeNested=!1,a.ref().child("UserAuthInfo").child(s.uid).once("value",function(o){null!=o.val()?(alertify.error("You Already Signed Up With That Provider. Try logging in with that provider!"),a.ref().unauth()):vex.dialog.prompt({message:"What Email Do you want?",placeholder:"Email...",callback:function(o){l.$loaded(function(i){for(var t=0;t<i.length;t++)if(i[t].Username==s[r].username){e.isDupe=!0;break}1!=e.isDupe?a.ref().createUser({email:o,password:u(16)},function(e,i){if(e)switch(e.code){case"EMAIL_TAKEN":alertify.error("The new user account cannot be created because the email is already in use.");break;case"INVALID_EMAIL":alertify.error("The specified email is not a valid email.");break;default:alertify.error("Error creating user:",e)}else"twitter"==r||"google"==r?"google"==r?(a.ref().child("UserAuthInfo").child(s.uid).set({Username:s[r].displayName,Email:o,UID:s.uid,Image:s[r].profileImageURL,Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:"http://rmdeaftheatre.com/wp-content/uploads/2012/11/gray-background-3.jpg",followers:0,following:0,profileViews:0,Precence:-1}),alertify.success("Sucessfully Reistered. Login Now!"),a.ref().unauth()):(a.ref().child("UserAuthInfo").child(s.uid).set({Username:s[r].username,Email:o,UID:s.uid,Image:s[r].profileImageURL,Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:s[r].cachedUserProfile.profile_background_image_url_https,followers:0,following:0,profileViews:0,Precence:-1}),alertify.success("Sucessfully Reistered. Login Now!"),a.ref().unauth()):(a.ref().child("UserAuthInfo").child(s.uid).set({Username:s[r].username,Email:o,UID:s.uid,Image:s[r].profileImageURL,Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:"http://rmdeaftheatre.com/wp-content/uploads/2012/11/gray-background-3.jpg",followers:0,following:0,profileViews:0,Precence:-1}),alertify.success("Sucessfully Reistered. Login Now!"),a.ref().unauth())}):vex.dialog.prompt({message:"Username is a duplicate. Please Choose another one.",placeholder:"Username..",callback:function(t){for(var l=0;l<i.length;l++)if(i[l].Username==t){e.isUsernameDupeNested=!0;break}0==e.isUsernameDupeNested?a.ref().createUser({email:o,password:u(16)},function(e,i){if(e)switch(e.code){case"EMAIL_TAKEN":alertify.error("The new user account cannot be created because the email is already in use.");break;case"INVALID_EMAIL":alertify.error("The specified email is not a valid email.");break;default:alertify.error("Error creating user:",e)}else"google"==r?(a.ref().child("UserAuthInfo").child(s.uid).set({Username:s[r].displayName,Email:o,UID:s.uid,Image:s[r].profileImageURL,Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:"http://rmdeaftheatre.com/wp-content/uploads/2012/11/gray-background-3.jpg",followers:0,following:0,profileViews:0,Precence:-1}),alertify.success("Sucessfully Reistered. Login Now!"),a.ref().unauth()):(a.ref().child("UserAuthInfo").child(s.uid).set({Username:s[r].username,Email:o,UID:s.uid,Image:s[r].profileImageURL,Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:s[r].cachedUserProfile.profile_background_image_url_https,followers:0,following:0,profileViews:0,Precence:-1}),alertify.success("Sucessfully Reistered. Login Now!"),a.ref().unauth())}):(alertify.error("The username you entered is another dupe... Refresh will be made soon. Please Give a Unique Username next time you register."),a.ref().unauth(),setTimeout(function(){location.reload(!0)},1e4))}})})}})})}})},e.oAuthLogin=function(e){a.ref().authWithOAuthPopup(e,function(e,o){e?(alertify.error("Log in Failed. See Console for more details"),console.error("ERROR LOGIN : "+e)):a.ref().child("UserAuthInfo").child(o.uid).once("value",function(e){null==e.val()?(alertify.error("You Havent Signed Up With That Provider! Try Registering That Provider First!"),a.ref().unauth()):(alertify.success("Sucessfully Logged In!"),r.go("authHome.desc"))})})},e.login=function(){a.ref().authWithPassword({email:e.user.email,password:e.user.password},function(e,a){e?(alertify.error("Unsucessfull Authentication. See console for details"),console.error(e)):(alertify.success("Sucessfull Authentication"),r.go("authHome"))})},e.regissterForm=function(){e.isUsernameDupe=!1,a.ref().child("UserAuthInfo").on("value",function(r){r.forEach(function(r){var a=(r.key(),r.val());return a.Username==e.register.username?void(e.isUsernameDupe=!0):void 0}),e.register.terms&&1!=e.isUsernameDupe?0==e.isUsernameDupe&&a.ref().createUser({email:e.register.email,password:e.register.password},function(r,o){if(r)switch(r.code){case"EMAIL_TAKEN":alertify.error("The new user account cannot be created because the email is already in use.");break;case"INVALID_EMAIL":alertify.error("The specified email is not a valid email.");break;default:alertify.error("Error creating user:",r)}else e.$evalAsync(function(){var r=n.getLetterURL(e.register.username,e.loadImageJSON);setTimeout(function(){console.log(r),a.ref().child("UserAuthInfo").child(o.uid).set({Username:e.register.username,Email:e.register.email,UID:o.uid,Image:n.getLetterURL(e.register.username),Moderator:!1,BronzeBadge:0,SilverBadge:0,GoldBadge:0,PlatinumBadge:0,newUser:!0,profileBackground:"http://rmdeaftheatre.com/wp-content/uploads/2012/11/gray-background-3.jpg",followers:0,following:0,profileViews:0,Precence:-1})},1500),alertify.success("Sucessfully Registered")})}):1==e.isUsernameDupe?alertify.error("Username already in use"):alertify.warning("You Must Accept Terms and Services Before Procceding!")})},e.setResponse=function(){l.show(l.alert().clickOutsideToClose(!0).title("Sucess").textContent("Recaptcha Submited Sucessfully").ariaLabel("Offscreen Demo").ok("Redirecting...").openFrom({top:-50,width:30,height:80}).closeTo({left:1500})),setTimeout(function(){l.cancel()},1e3)}}var a=e.module("ForumApp");a.controller("authCtrl",["$scope","$state","refService","$firebaseObject","authCheckTrueService","$firebaseArray","$http","$mdDialog","letterAvatarService",r])}(angular);